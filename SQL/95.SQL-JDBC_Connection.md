# 5. SQL - JDBC / Connection
>  Statement / PreparedStatement / DAO / DTO

<br>
<br>

- âœğŸ» **Recorded Date** : 2022ë…„ 11ì›” 17ì¼ ì˜¤í›„ 8:46
- ğŸ”– **Notion** : [ë…¸ì…˜ì—ì„œ ë³´ê¸°](https://www.notion.so/4-SQL-JDBC-Connection-213645b5dd08427094f3f0e4947c5126)
- ğŸ’¬ **Comment** : ì˜¤ëŠ˜ JSë¥¼ ë°°ìš°ë©´ì„œ í˜¼ë€ì´ ì˜¤ê¸° ì‹œì‘í–ˆë‹¤.<br>ìë°” ë°°ìš°ê³  SQL / HTML / CSSë¥¼ ë°°ì› ì„ ë• ì–¸ì–´ê°€ í™•ì—°íˆ ë‹¬ë¼ ì˜¤íˆë ¤ ì‰¬ì› ë‹¤.<br>ìë°”ìŠ¤í¬ë¦½íŠ¸ì™€ ìë°”ì˜ ë¬¸ë²•ì€ ì•„ì§ ë‚˜ë¡œì„  ë„ˆë¬´ ë¹„ìŠ·í•˜ê²Œ ëŠê»´ì ¸ ìê¾¸ í—·ê°ˆë¦°ë‹¤ğŸ˜¢<br>ì§€ê¸ˆê¹Œì§€ ëŠ˜ ê·¸ë‚  ë°°ìš´ ê²ƒì€ ìµœëŒ€í•œ ë§ì€ ìë£Œë¥¼ ì°¸ê³ í•˜ê³  'ì´í•´'í•˜ë ¤ ë…¸ë ¥í–ˆë‹¤.<br>ê·¼ë° ì˜¤íˆë ¤ ë„ˆë¬´ ì´í•´í•˜ë ¤ ë“œë‹ˆê¹Œ ì–´ë ¤ìš´ ê±° ê°™ê¸°ë„ í•˜ê³ ..ğŸ˜¢<br>ì´ì œ ë¬´ì‘ì • ì™¸ì›Œì•¼ í•˜ëŠ” ìˆœê°„ì´ ì˜¨ ê±¸ê¹Œâ€¦?ëŠ” ë‚´ ì„±ê²©ìƒ ê·¸ë ‡ê² ëª»í•¨ğŸ˜‹<br>ì•„ëª°ë‘.. ë¬´íŠ¼ ê°•ì˜ ëë‚˜ê³  ë©˜ë¶•ì— ë¹ ì ¸ ìˆëŠ”ë° ë¬¸ìê°€ ì™”ë‹¤. ê¸°í”„í‹°ì½˜ê³¼ í•¨ê»˜<br>ë‚´ê°€ 1ë¶„ê¸° ìš°ìˆ˜í›ˆë ¨ìƒì´ë€ë‹¤! ì¼ë‹¨ ê¸°ë»í•˜ê¸°ğŸ‰ğŸ‰<br>ì •ì‹  ì°¨ë¦¬ë¼ëŠ” í•˜ëŠ˜ì˜ ëœ»ì¸ê°€ ë³´ë‹¤ğŸ¤£ ê°ì‚¬í•©ë‹ˆë‹¤ì•„ã…ã…ã…<br>ê¸°ë¶„ ì¢‹ìœ¼ë‹ˆê¹Œ, ì´ê²ƒë„ ëƒ…ë‹¤ ë°•ì œ í•´ë†“ê¸°! ì˜¤ëŠ˜ì˜ ê³ ë¯¼ë„ ì–¸ì  ê°„ ì§€ë‚˜ê°ˆê±°ì•¼...!ğŸ˜Œ<br>
<img src="./img/1202_00.png">


<br>
<br>

## ğŸ”¸ 1. JDBC Driver

### â—½ 1-1. DriverManager í´ë˜ìŠ¤

- connection êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±

### â—½ 1-2. Connection ì¸í„°í˜ì´ìŠ¤

- Statement
    - SQLì˜ DDLê³¼ DML ì‹¤í–‰ ì‹œ ì‚¬ìš©
- PreparedStatement
    - SQLì˜ DDLê³¼ DML ì‹¤í–‰ ì‹œ ì‚¬ìš©
    - ë§¤ê°œë³€ìˆ˜í™”ëœ SQLë¬¸ì„ ì‚¬ìš©í•˜ì—¬ í¸ë¦¬ì„±ê³¼ ë³´ì•ˆì„±ì— ìœ ë¦¬
- ResultSet
    - DBì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ ì½ìŒ

<br><br>

## ğŸ”¸ 2. Connection - ì ‘ì†í•˜ê¸°

- ì‹¤ì œ ìë°” í”„ë¡œê·¸ë¨ê³¼ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë„¤íŠ¸ì›Œí¬ìƒ ì—°ê²°í•´ì£¼ëŠ” ë©”ì†Œë“œ
- **ì—°ê²°ì— ì„±ê³µí•˜ë©´** **DBì™€ ì—°ê²°ëœ ìƒíƒœë¥¼ Connection ê°ì²´ë¡œ í‘œí˜„í•˜ì—¬ ë°˜í™˜**

```java
String url = "jdbc:mysql://localhost:3306/sample" //í”„ë¡œí† ì½œ, ì„œë²„ì£¼ì†Œ, ì„œë²„í¬íŠ¸, DBì´ë¦„
String user = "mcuser"                            // DBì„œë²„ì— ë¡œê·¸ì¸í•  ê³„ì •
String password = "****"                          // DBì„œë²„ì— ë¡œê·¸ì¸í•  ë¹„ë°€ë²ˆí˜¸

Connection conn = null;
conn = DriverManager.getConnection(connStr, user, password);

conn.close                                        // ì˜ˆì™¸ì²˜ë¦¬ì—ì„œ ì—°ê²°ì„ ë‹«ì•„ì¤˜ì•¼í•¨
```

- [ì°¸ê³  ì½”ë“œ](https://github.com/6suk/JavaLecture/blob/master/src/mysql/customer/DAO.java) :  `DAO.java` `myGetConn()`
- Properties íŒŒì¼ì„ ì´ìš©í•œ ì ‘ì†

```java
public Connection myGetConn() {
		**Connection conn = null;**
		try {
			InputStream is = new FileInputStream("propertiesíŒŒì¼ ê²½ë¡œ");
			Properties props = new Properties();
			props.load(is);
			is.close();

			String host = props.getProperty("host");
			String user = props.getProperty("user");
			String password = props.getProperty("password");
			String database = props.getProperty("database");
			String port = props.getProperty("port", "3306");
			String connStr = "jdbc:mysql://" + host + ":" + port + "/" + database;
			**conn = DriverManager.getConnection(connStr, user, password);**
		} catch (Exception e) {
			e.printStackTrace();
		}
		return conn;
	}
```

<br><br>

## ğŸ”¸ 3. Statement / PreparedStatement - SQLë¬¸ ì „ì†¡

- Connectionìœ¼ë¡œ ìë°” í”„ë¡œê·¸ë¨ê³¼ DBê°€ ì—°ê²°ì´ ë˜ì—ˆë‹¤ë©´
- ìë°”ëŠ” SQLë¬¸ì„ ì „ì†¡, DBëŠ” ì²˜ë¦¬ëœ ê²°ê³¼ë¥¼ ì „ë‹¬

<br>

## ğŸ”¹ 3-1. Statement

### â—½ â‘  Statement - ê°ì²´ ìƒì„±

```java
Statement stmt = conn.createStatement();
```

### â—½ â‘¡ Statement - **SQLë¬¸ ì‹¤í–‰**

- **ì¸ìê°’**ìœ¼ë¡œ SQLë¬¸ì´ í•„ìš”í•˜ë‹¤.
- `ResultSet executeQuery(String sql)` â‡’ selectí•œ ê²°ê³¼ê°’ ë°˜í™˜
- `int executeUpdate(String sql)` â‡’ SQLë¬¸ ì‹¤í–‰(U,D,I)í›„ ì˜í–¥ì„ ë°›ì€ rowì˜ ê°œìˆ˜ ë°˜í™˜

```java
String sql = "INSERT INTO customer(uid,name) VALUES("koandjo","ê³ ì˜ˆë¦¼");";
ResultSet rs = stmt.executeUpdate(sql); 

stmt.close(); // ì˜ˆì™¸ ì²˜ë¦¬ì—ì„œ ì—°ê²° ë‹«ì•„ì£¼ê¸°
```

### â—½ â‘¢ Statement - ì˜ˆì œ

```java
Connection conn = myGetConn();            // Connection

String sql = "INSERT INTO customer(uid,name) VALUES("koandjo","ê³ ì˜ˆë¦¼");";
Statement stmt = conn.createStatement();  // ê°ì²´ ìƒì„±

stmt.executeUpdate(sql);                  // Case1. ì‹¤í–‰
int result = stmt.executeUpdate(sql);     // Case2. ì‹¤í–‰, ëª‡ê°œë¥¼ ì‹¤í–‰í–ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆë‹¤.
```
<br>

## ğŸ”¹ 3-2. PreparedStatement

### â—½ â‘  PreparedStatement - ê°ì²´ ìƒì„±

- Statementì™€ ë‹¤ë¥´ê²Œ PreparedStatementì˜ ê°ì²´ ìƒì„±ì€ **â€˜ì¤€ë¹„ëœ ìƒíƒœâ€™**
- `?`ê°€ ë“¤ì–´ê°„ String íƒ€ì…ì˜ SQLë¬¸ì´ ê°ì²´ ìƒì„± ì‹œ **ì¸ìê°’**ì´ ë˜ì–´ì•¼í•œë‹¤.

```java
String sql = "INSERT INTO customer(uid,name) VALUES(?,?);";     // SQLë¬¸
PreparedStatement pStmt = conn.prepareStatement(sql);           // ì¤€ë¹„ëœ ìƒíƒœ
```

### â—½ â‘¡ PreparedStatement - ì‹¤í–‰ ì „ `?` ë§¤ê°œë³€ìˆ˜ ì±„ìš°ê¸°

```java
String city = "ì„œìš¸";
int id = 2331;

pstmt.setString(1, city);
pstmt.setInt(2, id); // ë¬¼ìŒí‘œ ì±„ìš°ê¸°
```

### â—½ â‘¢ PreparedStatement - SQLë¬¸ ì‹¤í–‰

- ê°ì²´ ìƒì„± ì‹œ SQL ì¸ìê°’ì„ ì£¼ì—ˆê¸° ë•Œë¬¸ì— **ì‹¤í–‰ ì‹œ ì¸ìê°’ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤**.
- `ResultSet executeQuery(String sql)` â‡’ selectí•œ ê²°ê³¼ê°’ ë°˜í™˜
- `int executeUpdate(String sql)` â‡’ SQLë¬¸ ì‹¤í–‰(U,D,I)í›„ ì˜í–¥ì„ ë°›ì€ rowì˜ ê°œìˆ˜ ë°˜í™˜

```java
pstmt.executeUpdate();
pstmt.close(); // ì˜ˆì™¸ ì²˜ë¦¬ì—ì„œ ì—°ê²° ë‹«ì•„ì£¼ê¸°
```

### â—½ â‘£ PreparedStatement - ì˜ˆì œ

```java
Connection conn = myGetConn();                                  // Connection

// ì¤€ë¹„
String sql = "INSERT INTO customer(uid,name) VALUES(?,?);";     // SQLë¬¸
PreparedStatement pStmt = conn.prepareStatement(sql); 

pStmt.setString(1, user.getUid());
pStmt.setString(2, user.getName());                             // ë¬¼ìŒí‘œ ì±„ìš°ê¸°

//ì‹¤í–‰
pStmt.executeUpdate();

```

<br><br>

## ğŸ”¸ 4. DAO / DTO

### â—½ 4-1. DTO (Data Transfer Object)

- **ë°ì´í„° ë¦¬ìŠ¤íŠ¸**ê°€ ë“¤ì–´ìˆëŠ” í´ë˜ìŠ¤
- ì˜ˆì œ
    
    ```java
    private String uid, pwd, name, tel, email;
    private LocalDate regDate;
    private int isDeleted;
    ```
    

### â—½ 4-2. DAO (Data Access Object)

- **ë°ì´í„°ë¥¼ ë„˜ê²¨ì£¼ê¸° ìœ„í•œ ë©”ì†Œë“œ**ê°€ í¬í•¨ëœ í´ë˜ìŠ¤
- ì˜ˆì œ
    
    ```java
    List<UserDTO> getUserList(int limit)
    UserDTO getUserInfo(String uid)
    void insertUser(Customer user)
    void updateUser(Customer user)
    void deleteUser(Customer user)
    ```
    

<br><br><br><br>